<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haut-Karabagh : Atlas Historique</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <style>
        :root { --dark-bg: #0b0e14; --panel-bg: #161b22; --accent: #00a8ff; }
        body { background-color: var(--dark-bg); color: white; font-family: 'Segoe UI', sans-serif; height: 100vh; overflow: hidden; margin: 0; }
        
        #main-container { display: flex; height: calc(100vh - 100px); }
        #sidebar { width: 400px; background: var(--panel-bg); border-right: 1px solid #30363d; overflow-y: auto; padding: 20px; }
        #map { flex: 1; }
        #footer { height: 100px; background: var(--panel-bg); padding: 10px 40px; border-top: 1px solid #30363d; }

        .event-card { 
            background: #21262d; border: 1px solid #30363d; border-radius: 8px; 
            padding: 15px; margin-bottom: 12px; cursor: pointer; transition: 0.3s;
        }
        .event-card:hover { border-color: var(--accent); background: #1c2128; }
        .active-year { border-left: 4px solid var(--accent); box-shadow: 0 0 15px rgba(0, 168, 255, 0.1); }
        
        .tag { font-size: 10px; padding: 2px 6px; border-radius: 3px; color: white; text-transform: uppercase; font-weight: bold; }
        .btn-detail { color: var(--accent); text-decoration: none; font-size: 12px; font-weight: bold; margin-top: 10px; display: inline-block; }
        
        /* Custom scrollbar */
        #sidebar::-webkit-scrollbar { width: 6px; }
        #sidebar::-webkit-scrollbar-thumb { background: #30363d; border-radius: 10px; }

        .leaflet-popup-content-wrapper { background: #161b22; color: white; }
    </style>
</head>
<body>

<div id="main-container">
    <div id="sidebar">
        <h4 class="mb-4 text-info"><i class="fa-solid fa-history"></i> Chronologie des 21 Événements</h4>
        <div id="event-list"></div>
    </div>
    <div id="map"></div>
</div>

<div id="footer">
    <div class="d-flex justify-content-between mb-2">
        <span class="badge bg-secondary">1921</span>
        <h5 class="text-info" id="year-display">Année : 2024</h5>
        <span class="badge bg-secondary">2024</span>
    </div>
    <input type="range" class="form-range" id="year-slider" min="1921" max="2024" value="2024">
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // 1. LES DONNÉES JSON INTÉGRÉES
    const eventData = [
    { "year": 1920, "coords": [39.758, 46.742], "type": "POGROM", "title": "Massacre de Chouchi", "desc": "En mars 1920, les forces azéries détruisent la moitié arménienne de la ville de Chouchi. Des milliers de civils sont tués et le quartier arménien est réduit en cendres.", "impact": "Définit Chouchi comme un point de rupture historique." },
    { "year": 1921, "coords": [39.815, 46.755], "type": "POLITIQUE", "title": "Décision du Kavburo", "desc": "Sous l'influence de Staline, le Bureau caucasien décide de rattacher le Haut-Karabagh à l'Azerbaïdjan soviétique.", "impact": "Création de la bombe à retardement géopolitique." },
    { "year": 1923, "coords": [39.825, 46.765], "type": "POLITIQUE", "title": "Création de l'OAHK", "desc": "L'Azerbaïdjan crée officiellement la Région Autonome, isolée de l'Arménie par le tracé des frontières.", "impact": "Début de l'enclavement institutionnel." },
    { "year": 1963, "coords": [39.805, 46.745], "type": "POLITIQUE", "title": "Pétition des 2500", "desc": "Première grande contestation arménienne demandant le rattachement à l'Arménie sous l'ère soviétique.", "impact": "Réveil du sentiment national." },
    { "year": 1988, "coords": [39.835, 46.775], "type": "POLITIQUE", "title": "Vote du 20 Février", "desc": "Le Parlement régional demande officiellement son transfert vers l'Arménie, marquant le début du mouvement moderne.", "impact": "Déclenchement du conflit ouvert." },
    { "year": 1988, "coords": [40.589, 49.668], "type": "POGROM", "title": "Massacres de Soumgaït", "desc": "Violences extrêmes contre les Arméniens en Azerbaïdjan près de Bakou.", "impact": "Le point de non-retour émotionnel." },
    { "year": 1988, "coords": [40.648, 46.357], "type": "POGROM", "title": "Pogrom de Kirovabad", "desc": "Violences forçant des milliers de personnes à fuir. Début de l'exode croisé massif.", "impact": "Disparition des minorités locales." },
    { "year": 1990, "coords": [40.409, 49.867], "type": "POGROM", "title": "Janvier Noir à Bakou", "desc": "Pogrom anti-arménien à Bakou suivi de l'intervention de l'armée rouge.", "impact": "Fin de la présence arménienne historique à Bakou." },
    { "year": 1991, "coords": [39.950, 46.920], "type": "GUERRE", "title": "Opération Anneau", "desc": "Opération militaire brutale pour vider les villages arméniens du nord du Karabagh.", "impact": "Le conflit bascule dans la guerre totale." },
    { "year": 1991, "coords": [39.810, 46.780], "type": "POLITIQUE", "title": "Proclamation d'Indépendance", "desc": "Le 2 septembre, la République du Haut-Karabagh déclare son indépendance après la chute de l'URSS.", "impact": "Naissance d'un État de facto." },
    { "year": 1992, "coords": [39.995, 46.790], "type": "BATAILLE", "title": "Massacre de Khodjaly", "desc": "Des centaines de civils azéris fuyant les combats sont tués lors de la prise de la ville.", "impact": "Traumatisme national pour l'Azerbaïdjan." },
    { "year": 1992, "coords": [40.215, 46.825], "type": "BATAILLE", "title": "Massacre de Maragha", "desc": "Attaque du village arménien de Maragha par les forces azéries, faisant des dizaines de victimes civiles.", "impact": "Escalade de la violence de représailles." },
    { "year": 1992, "coords": [39.818, 46.752], "type": "BATAILLE", "title": "Siège de Stepanakert", "desc": "La capitale subit un pilonnage constant depuis Chouchi. Catastrophe humanitaire majeure.", "impact": "Survie de la population en jeu." },
    { "year": 1992, "coords": [39.755, 46.748], "type": "BATAILLE", "title": "Libération de Chouchi", "desc": "Prise de la forteresse par les forces arméniennes, mettant fin aux tirs sur la capitale.", "impact": "Tournant militaire décisif." },
    { "year": 1992, "coords": [39.635, 46.545], "type": "LOGISTIQUE", "title": "Prise de Latchine", "desc": "Ouverture du corridor terrestre reliant l'enclave à l'Arménie.", "impact": "Fin du blocus physique initial." },
    { "year": 1993, "coords": [40.105, 46.035], "type": "POLITIQUE", "title": "Résolution 822 de l'ONU", "desc": "L'ONU demande le retrait des forces arméniennes des districts occupés.", "impact": "Pression internationale sur le contrôle territorial." },
    { "year": 1994, "coords": [39.005, 46.505], "type": "POLITIQUE", "title": "Cessez-le-feu de Bichkek", "desc": "Signature d'un armistice gelant le conflit pendant plus de deux décennies.", "impact": "Début du statu quo prolongé." },
    { "year": 1998, "coords": [40.178, 44.513], "type": "POLITIQUE", "title": "Chute de Ter-Petrossian", "desc": "Démission du président arménien partisan d'un compromis, remplacé par une ligne dure.", "impact": "Durcissement des négociations." },
    { "year": 2001, "coords": [24.555, -81.785], "type": "POLITIQUE", "title": "Sommet de Key West", "desc": "Tentative de paix historique aux USA qui échoue malgré des espoirs concrets.", "impact": "Dernier grand élan diplomatique." },
    { "year": 2005, "coords": [38.985, 45.405], "type": "CULTURE", "title": "Destruction de Djoulfa", "desc": "Effacement systématique du cimetière de khatchkars arméniens au Nakhitchevan.", "impact": "Guerre contre le patrimoine culturel." },
    { "year": 2012, "coords": [40.415, 49.875], "type": "POLITIQUE", "title": "Affaire Ramil Safarov", "desc": "Grâce et promotion de l'officier azéri ayant tué un soldat arménien en Europe.", "impact": "Rupture totale de la confiance diplomatique." },
    { "year": 2016, "coords": [40.208, 46.812], "type": "GUERRE", "title": "Guerre des Quatre Jours", "desc": "Reprise brutale des combats de haute intensité sur toute la ligne de front.", "impact": "Prélude à la guerre de 2020." },
    { "year": 2020, "coords": [39.410, 47.110], "type": "GUERRE", "title": "Offensive des 44 Jours", "desc": "Déclenchement d'une guerre technologique massive avec soutien actif de la Turquie.", "impact": "Revers militaire arménien majeur." },
    { "year": 2020, "coords": [39.759, 46.749], "type": "CULTURE", "title": "Bombardement de Ghazanchetsots", "desc": "Missiles frappant la cathédrale de Chouchi, symbole religieux arménien.", "impact": "Traumatisme culturel et spirituel." },
    { "year": 2020, "coords": [39.751, 46.741], "type": "BATAILLE", "title": "Chute de Chouchi (2020)", "desc": "Reprise de la ville par l'Azerbaïdjan, scellant le sort de la guerre.", "impact": "Fin de la défense de l'Artsakh." },
    { "year": 2020, "coords": [39.639, 46.549], "type": "POLITIQUE", "title": "Accord du 9 Novembre", "desc": "Capitulation arménienne et perte de la majorité du territoire contrôlé depuis 1994.", "impact": "Nouveau redécoupage par la Russie." },
    { "year": 2022, "coords": [39.642, 46.552], "type": "LOGISTIQUE", "title": "Blocus du Corridor", "desc": "Fermeture de la route de Latchine par Bakou, affamant la population de l'enclave.", "impact": "Asphyxie humanitaire finale." },
    { "year": 2023, "coords": [39.812, 46.758], "type": "GUERRE", "title": "Offensive Finale", "desc": "Attaque éclair de 24h forçant la dissolution complète de la République d'Artsakh.", "impact": "Capitulation politique totale." },
    { "year": 2023, "coords": [39.645, 46.555], "type": "EXODE", "title": "Le Grand Exode", "desc": "Fuite de 120 000 civils arméniens vers l'Arménie en quelques jours.", "impact": "Fin de la présence arménienne millénaire." },
    { "year": 2023, "coords": [39.648, 46.558], "type": "POLITIQUE", "title": "Arrestation du Gouvernement", "desc": "Capture des dirigeants de l'Artsakh par les forces azéries lors de l'exode.", "impact": "Élimination des structures politiques de la région." }
];
    // 2. INITIALISATION CARTE
    const map = L.map('map', { zoomControl: false }).setView([39.82, 46.75], 8);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

    let markers = [];

    // 3. FONCTION DE MISE À JOUR
    function update(selectedYear) {
        document.getElementById('year-display').innerText = `Année : ${selectedYear}`;
        const list = document.getElementById('event-list');
        
        // Nettoyage
        markers.forEach(m => map.removeLayer(m));
        markers = [];
        list.innerHTML = "";

        eventData.forEach((ev, index) => {
            if (parseInt(ev.year) <= parseInt(selectedYear)) {
                
                // Définir couleur
                let color = "#3498db";
                if (ev.type === "BATAILLE" || ev.type === "GUERRE") color = "#e74c3c";
                if (ev.type === "POGROM" || ev.type === "EXODE") color = "#f39c12";

                // Marqueur
                const m = L.circleMarker(ev.coords, {
                    radius: 9,
                    fillColor: color,
                    color: "#fff",
                    weight: 1,
                    fillOpacity: 0.8
                }).addTo(map);
                
                m.bindPopup(`<b>${ev.title}</b><br><a href="details.html?id=${index}">Détails</a>`);
                markers.push(m);

                // Sidebar Card
                const card = document.createElement('div');
                card.className = `event-card ${ev.year == selectedYear ? 'active-year' : ''}`;
                card.innerHTML = `
                    <span class="tag" style="background:${color}">${ev.type}</span>
                    <h6 class="mt-2 mb-1">${ev.year} - ${ev.title}</h6>
                    <p class="small text-secondary mb-1">${ev.desc.substring(0, 70)}...</p>
                    <a href="details.html?id=${index}" class="btn-detail">Lire le récit complet →</a>
                `;
                
                card.onclick = (e) => {
                    if(e.target.tagName !== 'A') {
                        map.flyTo(ev.coords, 10);
                        m.openPopup();
                    }
                };
                list.prepend(card);
            }
        });
    }

    // 4. ÉCOUTEUR DU CURSEUR
    const slider = document.getElementById('year-slider');
    slider.addEventListener('input', (e) => update(e.target.value));

    // Lancer au chargement
    update(2024);
</script>
</body>
</html>